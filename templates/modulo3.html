{% extends "base.html" %}

{% block title %}Seguimiento Unidades - Sistema de Administración{% endblock %}

{% block content %}
<div class="card">
    <h2><i class="fas fa-clipboard-list"></i> Seguimiento de Unidades</h2>
    
    <div class="alert alert-info" id="infoAlert">
        <i class="fas fa-info-circle"></i> 
        <strong>Instrucciones:</strong> Arrastra tu archivo Excel (.xlsx o .xls) a la zona indicada o haz clic para seleccionarlo.
    </div>
    
    <div class="alert alert-success" id="successAlert">
        <i class="fas fa-check-circle"></i> 
        <strong>¡Éxito!</strong> El archivo se procesó correctamente.
    </div>
    
    <div class="alert alert-error" id="errorAlert">
        <i class="fas fa-exclamation-circle"></i> 
        <strong>Error:</strong> <span id="errorMessage"></span>
    </div>
    
    <!-- Botón de Unidades Postergadas (Persistente) -->
    <div style="margin: 20px 0; text-align: center;">
        <button class="btn btn-danger" id="openPostergadasModalBtn" onclick="openPostergadasModal()">
            <i class="fas fa-ban"></i> Gestionar Unidades Postergadas (<span id="postergadasCount">0</span>)
        </button>
        <p style="color: #718096; font-size: 0.9em; margin-top: 10px;">
            <i class="fas fa-info-circle"></i> Las unidades postergadas se filtrarán automáticamente de todos los archivos cargados
        </p>
    </div>
    
    <div class="drop-zone" id="dropZone">
        <i class="fas fa-cloud-upload-alt"></i>
        <p><strong>Arrastra tu archivo Excel aquí</strong></p>
        <p class="hint">o haz clic para seleccionar un archivo</p>
        <p class="hint" style="margin-top: 10px; font-size: 0.8em;">Formatos permitidos: .xlsx, .xls</p>
        <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
    </div>
    
    <div class="spinner" id="loadingSpinner"></div>
    
    <div id="resultContainer" style="display: none;">
        <div class="card-body">
            <!-- Aquí se insertarán las pestañas y tablas dinámicamente -->
        </div>
        
        <div style="margin-top: 20px; text-align: center; padding: 20px;">
            <button class="btn btn-primary" onclick="location.reload()">
                <i class="fas fa-redo"></i> Procesar Otro Archivo
            </button>
            <button class="btn btn-success" onclick="exportarSeguimientoAExcel()">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Librería para exportar a Excel real (XLSX) -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="{{ url_for('static', filename='js/modulo3.js') }}"></script>

<style>
@media print {
    .nav, .btn, .header p, .drop-zone, .alert, .spinner {
        display: none !important;
    }
    
    .container {
        box-shadow: none;
    }
    
    #resultContainer {
        display: block !important;
    }
}
</style>
{% endblock %}
